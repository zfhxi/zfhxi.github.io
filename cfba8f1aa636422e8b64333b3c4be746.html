<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- iOS Safari -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <!-- Chrome, Firefox OS and Opera Status Bar Color -->
  <meta name="theme-color" content="#FFFFFF">
  <meta property="og:title" content="Zynq7000私有定时器使用摘要">
    <meta name="description" content="简要介绍ZYNQ的私有定时中断的使用，在ZYNQ的纯PS里实现私有定时器中断。每隔一秒钟中断一次，在中断函数里计数加1，通过串口打印输出...">
  <meta property="og:description" content="简要介绍ZYNQ的私有定时中断的使用，在ZYNQ的纯PS里实现私有定时器中断。每隔一秒钟中断一次，在中断函数里计数加1，通过串口打印输出...">
    <meta property="og:type" content="blog">
  <title>Zynq7000私有定时器使用摘要</title>
  <!-- Favicon -->
    <link rel="shortcut icon" href="🏡">
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css">
  <link rel="stylesheet" type="text/css"
    href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.19.0/themes/prism-solarizedlight.min.css">
  <link rel="stylesheet" type="text/css" href="css/SourceSansPro.css">
  <link rel="stylesheet" type="text/css" href="css/notablog.css">
  <link rel="stylesheet" type="text/css" href="css/theme.css">
  <script src="https://cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <script src='https://unpkg.com/valine/dist/Valine.min.js'></script>
  <style>
    :root {
      font-size: 18px;
    }

    .DateTagBar {
      margin-top: 1.0rem;
    }
  </style>
</head>

<body>
  <nav class="Navbar">
    <a href="index.html">
      <div class="Navbar__Btn"><span>🏡</span> <span>Home</span></div>
    </a>
                                                                                                                                                                                                                    <span class="Navbar__Delim">&centerdot;</span>
    <a href="links.html">
      <div class="Navbar__Btn"><span>🔗</span> <span>Links</span></div>
    </a>
                <span class="Navbar__Delim">&centerdot;</span>
    <a href="about.html">
      <div class="Navbar__Btn"><span>👦🏻</span> <span>About</span></div>
    </a>
                          </nav>
  <header class="Header">
        <div class="Header__Spacer Header__Spacer--NoCover">
    </div>
    <div>
            <span class="Header__Title">Zynq7000私有定时器使用摘要</span>

    </div>
        <div class="DateTagBar">
            <span class="DateTagBar__Item DateTagBar__Date">Posted on Wed, Dec 4, 2019</span>
                  <span class="DateTagBar__Item DateTagBar__Tag DateTagBar__Tag--gray">
        <a href="tag/Zynq.html">Zynq</a>
      </span>
          </div>
      </header>
  <article id="https://www.notion.so/cfba8f1aa636422e8b64333b3c4be746" class="PageRoot"><ul id="https://www.notion.so/e825209048cc4f9782d0275872324525" class="ColorfulBlock ColorfulBlock--ColorGray TableOfContents"><li class="TableOfContents__Item"><a href="#https://www.notion.so/958ed68167b14da5b054edde0e7e2f05"><div style="margin-left:0px"><span class="SemanticStringArray"><span class="SemanticString">初始化私有定时器设备实例</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/4cfd1e7fa46945b598adbf4f26095da8"><div style="margin-left:0px"><span class="SemanticStringArray"><span class="SemanticString">设置定时器中断</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/c436fd57a5404196bfd54b6fa90bde71"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">1.初始化GIC中断控制器；</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/2a9abc6a9d354f1e949fb0fb2153650b"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">2.设置中断异常</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/037b7aaca67d4ba0899bcb8c2c728167"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">3.绑定中断服务函数</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/108493e763b542e3bcb4016736833007"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">4.使能中断</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/e2847accdc904c85bb7f9e3364214224"><div style="margin-left:0px"><span class="SemanticStringArray"><span class="SemanticString">启动私有定时器</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/a7deef14f35b46e6ba96b331d1058bc4"><div style="margin-left:0px"><span class="SemanticStringArray"><span class="SemanticString">实例参考</span></span></div></a></li></ul><div id="https://www.notion.so/e6b6598bb18f4b9f83a99918116981ae" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">参考文章：</span></span></p></div><div id="https://www.notion.so/db1500b1651b436ba2dc6db4496af00c" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="http://xilinx.eetrend.com/blog/2019/100043515.html">学会Zynq（9）定时器使用示例（PPI）</a></span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://my.oschina.net/msxbo/blog/3099104">米联客 ZYNQ/SOC精品教程 S02-CH08 定时器中断实验</a></span></span></p></div><h2 id="https://www.notion.so/958ed68167b14da5b054edde0e7e2f05" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/958ed68167b14da5b054edde0e7e2f05"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">初始化私有定时器设备实例</span></span></h2><pre id="https://www.notion.so/e38f588b402f4ec0b2694a82fa866427" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>XScuTimer_Config *XScuTimer_LookupConfig(u16 DeviceId);
</span></span></span></code></pre><div id="https://www.notion.so/87538625f7854b2cad6055c0e3041833" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">通过设备ID查找设备配置
</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">DeviceId</code></span><span class="SemanticString">，设备ID
返回</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">XScuTimer_Config</code></span><span class="SemanticString">型指针，指向配置表中对应设备ID的配置，若未查找到相应设备返回NULL。</span></span></p></div><pre id="https://www.notion.so/2f5cc9d032274820ae3289f15b211f1e" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>s32 XScuTimer_CfgInitialize(XScuTimer *InstancePtr,
			 XScuTimer_Config *ConfigPtr, u32 EffectiveAddress)
</span></span></span></code></pre><div id="https://www.notion.so/f3c6edf2df4a4d3b840fed2726f3d15d" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">初始化指定的定时器设备。
</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">InstancePtr</code></span><span class="SemanticString">，指向</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">XScuTimer</code></span><span class="SemanticString">的一个实例。
</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">ConfigPtr</code></span><span class="SemanticString">，指向定时器实例的配置信息结构体
</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">EffectiveAddress</code></span><span class="SemanticString">，设备的起始地址。
返回初始化的结果状态，初始化成功为</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">XST_SUCCESS</code></span><span class="SemanticString">或者已被使用</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">XST_DEVICE_IS_STARTED</code></span><span class="SemanticString">。</span></span></p></div><pre id="https://www.notion.so/1bf47c1ff79b49cbbf9547e8006c4836" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>#define XScuTimer_LoadTimer(InstancePtr, Value)				\\
	XScuTimer_WriteReg((InstancePtr)-&gt;Config.BaseAddr,		\\
			XSCUTIMER_LOAD_OFFSET, (Value))
</span></span></span></code></pre><div id="https://www.notion.so/e708d6bcb01f4f43b94530aacfb7d81b" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">加载定时器的计数器中的值，其本质上只是操作Timer Load寄存器。
</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">InstancePtr</code></span><span class="SemanticString">，指向</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">XScuTimer</code></span><span class="SemanticString">的一个实例。
</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">Value</code></span><span class="SemanticString">，计数的预加载值。
私有定时器是从装载值递减到0时发出中断。私有定时器的工作时钟为333MHz，每1/333M秒减1。因此若想定时1s，则装载值为1/(1/333M)-1，</span></span></p></div><pre id="https://www.notion.so/0e852b8883c5421a8a598d22324602f6" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>#define XScuTimer_EnableAutoReload(InstancePtr)				\\
	XScuTimer_WriteReg((InstancePtr)-&gt;Config.BaseAddr,		\\
			XSCUTIMER_CONTROL_OFFSET,			\\
			(XScuTimer_ReadReg((InstancePtr)-&gt;Config.BaseAddr, \\
				XSCUTIMER_CONTROL_OFFSET) |		 \\
				XSCUTIMER_CONTROL_AUTO_RELOAD_MASK))
</span></span></span></code></pre><div id="https://www.notion.so/1bfa4cdf631148afb593a38d11016c98" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">允许指定定时器设备实例能自动重载。</span></span></p></div><h2 id="https://www.notion.so/4cfd1e7fa46945b598adbf4f26095da8" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/4cfd1e7fa46945b598adbf4f26095da8"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">设置定时器中断</span></span></h2><div id="https://www.notion.so/9a6a957244e440dab11869345dd28d0a" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">中断时基本过程：初始化中断控制器、设置中断异常、连接中断、使能中断。</span></span></p></div><h3 id="https://www.notion.so/c436fd57a5404196bfd54b6fa90bde71" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/c436fd57a5404196bfd54b6fa90bde71"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">1.初始化GIC中断控制器；</span></span></h3><pre id="https://www.notion.so/101e2e91eaba4849a2a4527a927b041f" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>XScuGic_Config *XScuGic_LookupConfig(u16 DeviceId);
</span></span></span></code></pre><div id="https://www.notion.so/11510af8335a45c5b6bb2c9d9b1aa959" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">通过设备id查找设备的配置
</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">DeviceID</code></span><span class="SemanticString">，设备ID的唯一标识符。
返回</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">XScuGic_Config *</code></span><span class="SemanticString">型指针，指向指定设备的配置信息结构体中。</span></span></p></div><pre id="https://www.notion.so/fb0d320ca47c4bd1b97e5fdd2a6eef37" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>s32  XScuGic_CfgInitialize(XScuGic *InstancePtr,
				XScuGic_Config *ConfigPtr,
				u32 EffectiveAddr);
</span></span></span></code></pre><div id="https://www.notion.so/9438a51e395943cd98718a54fba8269b" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">对指定的中断控制器实例进行初始化。
</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">InstancePtr</code></span><span class="SemanticString">是指向</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">XScuGic</code></span><span class="SemanticString">实例的指针。
</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">ConfigPtr</code></span><span class="SemanticString">是指向所关联的特定设备的配置表的指针。
</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">EffectiveAddr</code></span><span class="SemanticString">是所关联设备的有效地址。</span></span></p></div><h3 id="https://www.notion.so/2a9abc6a9d354f1e949fb0fb2153650b" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/2a9abc6a9d354f1e949fb0fb2153650b"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">2.设置中断异常</span></span></h3><pre id="https://www.notion.so/0fe59e1794754beb97cfe73949f2c7b5" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>void Xil_ExceptionInit(void);
</span></span></span></code></pre><div id="https://www.notion.so/5293b81462194e5992d049b466258561" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">异常处理，在Coretex-A9中不做任何事，因为异常处理已被静态初始化。</span></span></p></div><pre id="https://www.notion.so/2923d25109c544e9b2bdf47183bfb20f" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>void Xil_ExceptionRegisterHandler(u32 Exception_id,
				    Xil_ExceptionHandler Handler,
				    void *Data);
</span></span></span></code></pre><div id="https://www.notion.so/afa6f83431dc4423b237d4849f2c941f" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">为特定的异常注册一个handler，当处理器发生特定异常后调用对应handler。
</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">Exception_id</code></span><span class="SemanticString">异常源的id。
</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">Handler</code></span><span class="SemanticString">是异常处理函数。
</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">Data</code></span><span class="SemanticString">是异常发生时，传给对应handler的参数。</span></span></p></div><pre id="https://www.notion.so/80690165fce44365bca3173587a62faf" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>#define Xil_ExceptionEnable() \\
		Xil_ExceptionEnableMask(XIL_EXCEPTION_IRQ)
</span></span></span></code></pre><div id="https://www.notion.so/277cfca22d1b41bb9c1f47c651ad1c0f" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">允许中断的异常处理。</span></span></p></div><h3 id="https://www.notion.so/037b7aaca67d4ba0899bcb8c2c728167" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/037b7aaca67d4ba0899bcb8c2c728167"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">3.绑定中断服务函数</span></span></h3><pre id="https://www.notion.so/f3c5cd17758f43e9be55448c686654c7" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>s32  XScuGic_Connect(XScuGic *InstancePtr, u32 Int_Id,
                      Xil_InterruptHandler Handler, void *CallBackRef);
</span></span></span></code></pre><div id="https://www.notion.so/ea8aa1c3f7404c888b234abd3f72f1b7" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">将指定中断服务函数绑定到指定中断号上。
</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">InstancePtr</code></span><span class="SemanticString">是指向</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">XScuGic</code></span><span class="SemanticString">实例的指针。
</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">Int_Id</code></span><span class="SemanticString">是中断源的中断号。
</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">Handler</code></span><span class="SemanticString">是中断处理函数。
</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">CallBackRef</code></span><span class="SemanticString">是回调的一个引用，一般是所连接的设备的指针。</span></span></p></div><h3 id="https://www.notion.so/108493e763b542e3bcb4016736833007" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/108493e763b542e3bcb4016736833007"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">4.使能中断</span></span></h3><pre id="https://www.notion.so/60ad831759c04faa96c432ae8ac9a2b5" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>void XScuGic_Enable(XScuGic *InstancePtr, u32 Int_Id);
</span></span></span></code></pre><div id="https://www.notion.so/2fd7da7a1ca0410899c1d7f51fc6c589" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">中断使能，在该函数调用后，可使对应id的pending的中断能够发生。
</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">InstancePtr</code></span><span class="SemanticString">是指向</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">XScuGic</code></span><span class="SemanticString">实例的指针。
</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">Int_Id</code></span><span class="SemanticString">是中断源的中断号。</span></span></p></div><pre id="https://www.notion.so/f71958103f8a4768b9c1af1070314ad7" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>#define XScuTimer_EnableInterrupt(InstancePtr)				\\
	XScuTimer_WriteReg((InstancePtr)-&gt;Config.BaseAddr,		\\
			XSCUTIMER_CONTROL_OFFSET,			\\
			(XScuTimer_ReadReg((InstancePtr)-&gt;Config.BaseAddr, \\
					XSCUTIMER_CONTROL_OFFSET) |	\\
					XSCUTIMER_CONTROL_IRQ_ENABLE_MASK))
</span></span></span></code></pre><div id="https://www.notion.so/5ad6ebff1a354fbe8c47311192f4fcdb" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">允许定时器中断。
</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">InstancePtr</code></span><span class="SemanticString">是指向私有定时器设备实例的指针。</span></span></p></div><h2 id="https://www.notion.so/e2847accdc904c85bb7f9e3364214224" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/e2847accdc904c85bb7f9e3364214224"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">启动私有定时器</span></span></h2><pre id="https://www.notion.so/e39a4cc26cf04b8491016182875fb5b0" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>void XScuTimer_Start(XScuTimer *InstancePtr);
</span></span></span></code></pre><div id="https://www.notion.so/637779d7c1894705a21d2ac0076578c2" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">启动定时器。
</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">InstancePtr</code></span><span class="SemanticString">是指向私有定时器设备实例的指针。</span></span></p></div><pre id="https://www.notion.so/0bdc5ef0cac64e399e4a13482a2350e2" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>#define XScuTimer_ClearInterruptStatus(InstancePtr)			\\
	XScuTimer_WriteReg((InstancePtr)-&gt;Config.BaseAddr,		\\
		XSCUTIMER_ISR_OFFSET, XSCUTIMER_ISR_EVENT_FLAG_MASK)
</span></span></span></code></pre><div id="https://www.notion.so/f7cdfca0d4e64813b15c95694397ecc1" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">清除中断状态。
</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">InstancePtr</code></span><span class="SemanticString">是指向私有定时器设备实例的指针。</span></span></p></div><div id="https://www.notion.so/8c2611d66812417e89cf858caa57a21d" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">在定时器中断处理程序中，我们必须清除中断标志，因此</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">XscuGic_Connect</code></span><span class="SemanticString">的第三个参数设置为定时器的控制设备实例的指针，在调用中断状态清除函数时会用到该参数。</span></span></p></div><h2 id="https://www.notion.so/a7deef14f35b46e6ba96b331d1058bc4" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/a7deef14f35b46e6ba96b331d1058bc4"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">实例参考</span></span></h2><div id="https://www.notion.so/e8e1548e2f1046d28e60be51c7d51cab" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">搬运米联客文章中的案例，完成私有定时器计秒。</span></span></p></div><pre id="https://www.notion.so/0b4d37532d584d2aa50773fffbe386ec" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>
/*
 *
 * www.osrc.cn
 * www.milinker.com
 * copyright by nan jin mi lian dian zi www.osrc.cn
 * axi dma test
 *
*/

#include &quot;xscugic.h&quot;
#include &quot;xil_exception.h&quot;
#include &quot;xscutimer.h&quot;
#include &quot;xparameters.h&quot;

#define INTC_DEVICE_ID          XPAR_SCUGIC_SINGLE_DEVICE_ID
extern volatile int usec;
//timer info
#define TIMER_DEVICE_ID     XPAR_XSCUTIMER_0_DEVICE_ID
#define TIMER_IRPT_INTR     XPAR_SCUTIMER_INTR

static XScuGic Intc; //GIC
static  XScuTimer Timer;//timer


#define TIMER_LOAD_VALUE    0x13D92D3F //1S

static void TimerIntrHandler(void *CallBackRef)
{

    XScuTimer *TimerInstancePtr = (XScuTimer *) CallBackRef;
    XScuTimer_ClearInterruptStatus(TimerInstancePtr);
    usec++;
    xil_printf(&quot; %d Second\\n\\r&quot;,usec);  //每秒打印输出一次
}

int init_timer(void)
{
    XScuTimer_Config *TMRConfigPtr;     //timer config
    //私有定时器初始化
    TMRConfigPtr = XScuTimer_LookupConfig(0);
    XScuTimer_CfgInitialize(&amp;Timer, TMRConfigPtr,TMRConfigPtr-&gt;BaseAddr);
    //XScuTimer_SelfTest(&amp;Timer);
    //加载计数周期，私有定时器的时钟为CPU的一半，为333MHZ,如果计数1S,加载值为1sx(333x1000x1000)(1/s)-1=0x13D92D3F
    XScuTimer_LoadTimer(&amp;Timer, TIMER_LOAD_VALUE);//F8F00600+0=reg=F8F00600
    //自动装载
    XScuTimer_EnableAutoReload(&amp;Timer);//F8F00600+8=reg=F8F00608
	XScuGic_Config *IntcConfig;
	IntcConfig = XScuGic_LookupConfig(INTC_DEVICE_ID);
	if (NULL == IntcConfig) {
		return XST_FAILURE;
	}
	int Status = XScuGic_CfgInitialize(&amp;Intc, IntcConfig,
					IntcConfig-&gt;CpuBaseAddress);
	if (Status != XST_SUCCESS) {
		return XST_FAILURE;
	}
	/* Enable interrupts from the hardware */
	Xil_ExceptionInit();
	Xil_ExceptionRegisterHandler(XIL_EXCEPTION_ID_INT,
			(Xil_ExceptionHandler)XScuGic_InterruptHandler,
			(void *)&amp;Intc);
	Xil_ExceptionEnable();
    XScuGic_Connect(&amp;Intc, TIMER_IRPT_INTR,
                    (Xil_ExceptionHandler)TimerIntrHandler,//set up the timer interrupt
                    (void *)&amp;Timer);

    XScuGic_Enable(&amp;Intc, TIMER_IRPT_INTR);//enable the interrupt for the Timer at GIC
    XScuTimer_EnableInterrupt(&amp;Timer);//enable interrupt on the timer
    XScuTimer_Start(&amp;Timer);
    return XST_SUCCESS;
}

int main(void)
{
	xil_printf(&quot;------------START-------------\\n&quot;);
	int Status=init_timer();
	if(Status!=XST_SUCCESS){
		xil_printf(&quot;Failed to initialize Timer!\\n\\r&quot;);
		return 0;
	}

	while(1);
}
</span></span></span></code></pre></article>  <div id="vcomments"></div>
  <script>
    new Valine({
      el: '#vcomments',
      appId: 'x3yNlOp8snKVbHLuM3MDgyPm-gzGzoHsz',
      appKey: 'IxbPmtJ4C181kqwCPyUfHb67',
      avatar: 'retro',
      placeholder: 'Welcome to comment here233!',
      requiredFields: ['nick', 'mail']
    })
  </script>
  <footer class="Footer">
    <div>&copy; idzc.me 2020</div>
    <div>&centerdot;</div>
    <div>Powered by <a href="https://github.com/dragonman225/notablog" target="_blank"
        rel="noopener noreferrer">Notablog</a>.
    </div>
  </footer>
</body>

</html>